<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」 | 右上↗</title><meta property="og:type" content="website"/><meta property="og:title" content="ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」"/><meta property="og:site_name" content="右上↗"/><meta property="twitter:card" content="summary"/><meta property="twitter:creator" content="@agatan_"/><meta property="twitter:title" content="ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/fcf459cc03a0aa33d72b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fcf459cc03a0aa33d72b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-20d43e08bea62467b090.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-588261c74baf7142d208.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a9e8b7fcb86503283a43.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-b731c6aa1c491f14d361.js" defer=""></script><script src="/_next/static/chunks/191-ac794077f326adb56e38.js" defer=""></script><script src="/_next/static/chunks/686-4b319bb0411076e06dbc.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-3b1d79cd751fba9fda5d.js" defer=""></script><script src="/_next/static/LTCqLRPEd5Qd2agqEQJZo/_buildManifest.js" defer=""></script><script src="/_next/static/LTCqLRPEd5Qd2agqEQJZo/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css-global o7558t">:host,:root{--chakra-ring-inset:var(--chakra-empty,/*!*/ /*!*/);--chakra-ring-offset-width:0px;--chakra-ring-offset-color:#fff;--chakra-ring-color:rgba(66, 153, 225, 0.6);--chakra-ring-offset-shadow:0 0 #0000;--chakra-ring-shadow:0 0 #0000;--chakra-space-x-reverse:0;--chakra-space-y-reverse:0;--chakra-colors-transparent:transparent;--chakra-colors-current:currentColor;--chakra-colors-black:#000000;--chakra-colors-white:#FFFFFF;--chakra-colors-whiteAlpha-50:rgba(255, 255, 255, 0.04);--chakra-colors-whiteAlpha-100:rgba(255, 255, 255, 0.06);--chakra-colors-whiteAlpha-200:rgba(255, 255, 255, 0.08);--chakra-colors-whiteAlpha-300:rgba(255, 255, 255, 0.16);--chakra-colors-whiteAlpha-400:rgba(255, 255, 255, 0.24);--chakra-colors-whiteAlpha-500:rgba(255, 255, 255, 0.36);--chakra-colors-whiteAlpha-600:rgba(255, 255, 255, 0.48);--chakra-colors-whiteAlpha-700:rgba(255, 255, 255, 0.64);--chakra-colors-whiteAlpha-800:rgba(255, 255, 255, 0.80);--chakra-colors-whiteAlpha-900:rgba(255, 255, 255, 0.92);--chakra-colors-blackAlpha-50:rgba(0, 0, 0, 0.04);--chakra-colors-blackAlpha-100:rgba(0, 0, 0, 0.06);--chakra-colors-blackAlpha-200:rgba(0, 0, 0, 0.08);--chakra-colors-blackAlpha-300:rgba(0, 0, 0, 0.16);--chakra-colors-blackAlpha-400:rgba(0, 0, 0, 0.24);--chakra-colors-blackAlpha-500:rgba(0, 0, 0, 0.36);--chakra-colors-blackAlpha-600:rgba(0, 0, 0, 0.48);--chakra-colors-blackAlpha-700:rgba(0, 0, 0, 0.64);--chakra-colors-blackAlpha-800:rgba(0, 0, 0, 0.80);--chakra-colors-blackAlpha-900:rgba(0, 0, 0, 0.92);--chakra-colors-gray-50:#F7FAFC;--chakra-colors-gray-100:#EDF2F7;--chakra-colors-gray-200:#E2E8F0;--chakra-colors-gray-300:#CBD5E0;--chakra-colors-gray-400:#A0AEC0;--chakra-colors-gray-500:#718096;--chakra-colors-gray-600:#4A5568;--chakra-colors-gray-700:#2D3748;--chakra-colors-gray-800:#1A202C;--chakra-colors-gray-900:#171923;--chakra-colors-red-50:#FFF5F5;--chakra-colors-red-100:#FED7D7;--chakra-colors-red-200:#FEB2B2;--chakra-colors-red-300:#FC8181;--chakra-colors-red-400:#F56565;--chakra-colors-red-500:#E53E3E;--chakra-colors-red-600:#C53030;--chakra-colors-red-700:#9B2C2C;--chakra-colors-red-800:#822727;--chakra-colors-red-900:#63171B;--chakra-colors-orange-50:#FFFAF0;--chakra-colors-orange-100:#FEEBC8;--chakra-colors-orange-200:#FBD38D;--chakra-colors-orange-300:#F6AD55;--chakra-colors-orange-400:#ED8936;--chakra-colors-orange-500:#DD6B20;--chakra-colors-orange-600:#C05621;--chakra-colors-orange-700:#9C4221;--chakra-colors-orange-800:#7B341E;--chakra-colors-orange-900:#652B19;--chakra-colors-yellow-50:#FFFFF0;--chakra-colors-yellow-100:#FEFCBF;--chakra-colors-yellow-200:#FAF089;--chakra-colors-yellow-300:#F6E05E;--chakra-colors-yellow-400:#ECC94B;--chakra-colors-yellow-500:#D69E2E;--chakra-colors-yellow-600:#B7791F;--chakra-colors-yellow-700:#975A16;--chakra-colors-yellow-800:#744210;--chakra-colors-yellow-900:#5F370E;--chakra-colors-green-50:#F0FFF4;--chakra-colors-green-100:#C6F6D5;--chakra-colors-green-200:#9AE6B4;--chakra-colors-green-300:#68D391;--chakra-colors-green-400:#48BB78;--chakra-colors-green-500:#38A169;--chakra-colors-green-600:#2F855A;--chakra-colors-green-700:#276749;--chakra-colors-green-800:#22543D;--chakra-colors-green-900:#1C4532;--chakra-colors-teal-50:#E6FFFA;--chakra-colors-teal-100:#B2F5EA;--chakra-colors-teal-200:#81E6D9;--chakra-colors-teal-300:#4FD1C5;--chakra-colors-teal-400:#38B2AC;--chakra-colors-teal-500:#319795;--chakra-colors-teal-600:#2C7A7B;--chakra-colors-teal-700:#285E61;--chakra-colors-teal-800:#234E52;--chakra-colors-teal-900:#1D4044;--chakra-colors-blue-50:#ebf8ff;--chakra-colors-blue-100:#bee3f8;--chakra-colors-blue-200:#90cdf4;--chakra-colors-blue-300:#63b3ed;--chakra-colors-blue-400:#4299e1;--chakra-colors-blue-500:#3182ce;--chakra-colors-blue-600:#2b6cb0;--chakra-colors-blue-700:#2c5282;--chakra-colors-blue-800:#2a4365;--chakra-colors-blue-900:#1A365D;--chakra-colors-cyan-50:#EDFDFD;--chakra-colors-cyan-100:#C4F1F9;--chakra-colors-cyan-200:#9DECF9;--chakra-colors-cyan-300:#76E4F7;--chakra-colors-cyan-400:#0BC5EA;--chakra-colors-cyan-500:#00B5D8;--chakra-colors-cyan-600:#00A3C4;--chakra-colors-cyan-700:#0987A0;--chakra-colors-cyan-800:#086F83;--chakra-colors-cyan-900:#065666;--chakra-colors-purple-50:#FAF5FF;--chakra-colors-purple-100:#E9D8FD;--chakra-colors-purple-200:#D6BCFA;--chakra-colors-purple-300:#B794F4;--chakra-colors-purple-400:#9F7AEA;--chakra-colors-purple-500:#805AD5;--chakra-colors-purple-600:#6B46C1;--chakra-colors-purple-700:#553C9A;--chakra-colors-purple-800:#44337A;--chakra-colors-purple-900:#322659;--chakra-colors-pink-50:#FFF5F7;--chakra-colors-pink-100:#FED7E2;--chakra-colors-pink-200:#FBB6CE;--chakra-colors-pink-300:#F687B3;--chakra-colors-pink-400:#ED64A6;--chakra-colors-pink-500:#D53F8C;--chakra-colors-pink-600:#B83280;--chakra-colors-pink-700:#97266D;--chakra-colors-pink-800:#702459;--chakra-colors-pink-900:#521B41;--chakra-colors-linkedin-50:#E8F4F9;--chakra-colors-linkedin-100:#CFEDFB;--chakra-colors-linkedin-200:#9BDAF3;--chakra-colors-linkedin-300:#68C7EC;--chakra-colors-linkedin-400:#34B3E4;--chakra-colors-linkedin-500:#00A0DC;--chakra-colors-linkedin-600:#008CC9;--chakra-colors-linkedin-700:#0077B5;--chakra-colors-linkedin-800:#005E93;--chakra-colors-linkedin-900:#004471;--chakra-colors-facebook-50:#E8F4F9;--chakra-colors-facebook-100:#D9DEE9;--chakra-colors-facebook-200:#B7C2DA;--chakra-colors-facebook-300:#6482C0;--chakra-colors-facebook-400:#4267B2;--chakra-colors-facebook-500:#385898;--chakra-colors-facebook-600:#314E89;--chakra-colors-facebook-700:#29487D;--chakra-colors-facebook-800:#223B67;--chakra-colors-facebook-900:#1E355B;--chakra-colors-messenger-50:#D0E6FF;--chakra-colors-messenger-100:#B9DAFF;--chakra-colors-messenger-200:#A2CDFF;--chakra-colors-messenger-300:#7AB8FF;--chakra-colors-messenger-400:#2E90FF;--chakra-colors-messenger-500:#0078FF;--chakra-colors-messenger-600:#0063D1;--chakra-colors-messenger-700:#0052AC;--chakra-colors-messenger-800:#003C7E;--chakra-colors-messenger-900:#002C5C;--chakra-colors-whatsapp-50:#dffeec;--chakra-colors-whatsapp-100:#b9f5d0;--chakra-colors-whatsapp-200:#90edb3;--chakra-colors-whatsapp-300:#65e495;--chakra-colors-whatsapp-400:#3cdd78;--chakra-colors-whatsapp-500:#22c35e;--chakra-colors-whatsapp-600:#179848;--chakra-colors-whatsapp-700:#0c6c33;--chakra-colors-whatsapp-800:#01421c;--chakra-colors-whatsapp-900:#001803;--chakra-colors-twitter-50:#E5F4FD;--chakra-colors-twitter-100:#C8E9FB;--chakra-colors-twitter-200:#A8DCFA;--chakra-colors-twitter-300:#83CDF7;--chakra-colors-twitter-400:#57BBF5;--chakra-colors-twitter-500:#1DA1F2;--chakra-colors-twitter-600:#1A94DA;--chakra-colors-twitter-700:#1681BF;--chakra-colors-twitter-800:#136B9E;--chakra-colors-twitter-900:#0D4D71;--chakra-colors-telegram-50:#E3F2F9;--chakra-colors-telegram-100:#C5E4F3;--chakra-colors-telegram-200:#A2D4EC;--chakra-colors-telegram-300:#7AC1E4;--chakra-colors-telegram-400:#47A9DA;--chakra-colors-telegram-500:#0088CC;--chakra-colors-telegram-600:#007AB8;--chakra-colors-telegram-700:#006BA1;--chakra-colors-telegram-800:#005885;--chakra-colors-telegram-900:#003F5E;--chakra-borders-none:0;--chakra-borders-1px:1px solid;--chakra-borders-2px:2px solid;--chakra-borders-4px:4px solid;--chakra-borders-8px:8px solid;--chakra-fonts-heading:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--chakra-fonts-body:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--chakra-fonts-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--chakra-fontSizes-xs:0.75rem;--chakra-fontSizes-sm:0.875rem;--chakra-fontSizes-md:1rem;--chakra-fontSizes-lg:1.125rem;--chakra-fontSizes-xl:1.25rem;--chakra-fontSizes-2xl:1.5rem;--chakra-fontSizes-3xl:1.875rem;--chakra-fontSizes-4xl:2.25rem;--chakra-fontSizes-5xl:3rem;--chakra-fontSizes-6xl:3.75rem;--chakra-fontSizes-7xl:4.5rem;--chakra-fontSizes-8xl:6rem;--chakra-fontSizes-9xl:8rem;--chakra-fontWeights-hairline:100;--chakra-fontWeights-thin:200;--chakra-fontWeights-light:300;--chakra-fontWeights-normal:400;--chakra-fontWeights-medium:500;--chakra-fontWeights-semibold:600;--chakra-fontWeights-bold:700;--chakra-fontWeights-extrabold:800;--chakra-fontWeights-black:900;--chakra-letterSpacings-tighter:-0.05em;--chakra-letterSpacings-tight:-0.025em;--chakra-letterSpacings-normal:0;--chakra-letterSpacings-wide:0.025em;--chakra-letterSpacings-wider:0.05em;--chakra-letterSpacings-widest:0.1em;--chakra-lineHeights-3:.75rem;--chakra-lineHeights-4:1rem;--chakra-lineHeights-5:1.25rem;--chakra-lineHeights-6:1.5rem;--chakra-lineHeights-7:1.75rem;--chakra-lineHeights-8:2rem;--chakra-lineHeights-9:2.25rem;--chakra-lineHeights-10:2.5rem;--chakra-lineHeights-normal:normal;--chakra-lineHeights-none:1;--chakra-lineHeights-shorter:1.25;--chakra-lineHeights-short:1.375;--chakra-lineHeights-base:1.5;--chakra-lineHeights-tall:1.625;--chakra-lineHeights-taller:2;--chakra-radii-none:0;--chakra-radii-sm:0.125rem;--chakra-radii-base:0.25rem;--chakra-radii-md:0.375rem;--chakra-radii-lg:0.5rem;--chakra-radii-xl:0.75rem;--chakra-radii-2xl:1rem;--chakra-radii-3xl:1.5rem;--chakra-radii-full:9999px;--chakra-space-1:0.25rem;--chakra-space-2:0.5rem;--chakra-space-3:0.75rem;--chakra-space-4:1rem;--chakra-space-5:1.25rem;--chakra-space-6:1.5rem;--chakra-space-7:1.75rem;--chakra-space-8:2rem;--chakra-space-9:2.25rem;--chakra-space-10:2.5rem;--chakra-space-12:3rem;--chakra-space-14:3.5rem;--chakra-space-16:4rem;--chakra-space-20:5rem;--chakra-space-24:6rem;--chakra-space-28:7rem;--chakra-space-32:8rem;--chakra-space-36:9rem;--chakra-space-40:10rem;--chakra-space-44:11rem;--chakra-space-48:12rem;--chakra-space-52:13rem;--chakra-space-56:14rem;--chakra-space-60:15rem;--chakra-space-64:16rem;--chakra-space-72:18rem;--chakra-space-80:20rem;--chakra-space-96:24rem;--chakra-space-px:1px;--chakra-space-0\.5:0.125rem;--chakra-space-1\.5:0.375rem;--chakra-space-2\.5:0.625rem;--chakra-space-3\.5:0.875rem;--chakra-shadows-xs:0 0 0 1px rgba(0, 0, 0, 0.05);--chakra-shadows-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--chakra-shadows-base:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--chakra-shadows-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--chakra-shadows-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--chakra-shadows-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04);--chakra-shadows-2xl:0 25px 50px -12px rgba(0, 0, 0, 0.25);--chakra-shadows-outline:0 0 0 3px rgba(66, 153, 225, 0.6);--chakra-shadows-inner:inset 0 2px 4px 0 rgba(0,0,0,0.06);--chakra-shadows-none:none;--chakra-shadows-dark-lg:rgba(0, 0, 0, 0.1) 0px 0px 0px 1px,rgba(0, 0, 0, 0.2) 0px 5px 10px,rgba(0, 0, 0, 0.4) 0px 15px 40px;--chakra-sizes-1:0.25rem;--chakra-sizes-2:0.5rem;--chakra-sizes-3:0.75rem;--chakra-sizes-4:1rem;--chakra-sizes-5:1.25rem;--chakra-sizes-6:1.5rem;--chakra-sizes-7:1.75rem;--chakra-sizes-8:2rem;--chakra-sizes-9:2.25rem;--chakra-sizes-10:2.5rem;--chakra-sizes-12:3rem;--chakra-sizes-14:3.5rem;--chakra-sizes-16:4rem;--chakra-sizes-20:5rem;--chakra-sizes-24:6rem;--chakra-sizes-28:7rem;--chakra-sizes-32:8rem;--chakra-sizes-36:9rem;--chakra-sizes-40:10rem;--chakra-sizes-44:11rem;--chakra-sizes-48:12rem;--chakra-sizes-52:13rem;--chakra-sizes-56:14rem;--chakra-sizes-60:15rem;--chakra-sizes-64:16rem;--chakra-sizes-72:18rem;--chakra-sizes-80:20rem;--chakra-sizes-96:24rem;--chakra-sizes-px:1px;--chakra-sizes-0\.5:0.125rem;--chakra-sizes-1\.5:0.375rem;--chakra-sizes-2\.5:0.625rem;--chakra-sizes-3\.5:0.875rem;--chakra-sizes-max:max-content;--chakra-sizes-min:min-content;--chakra-sizes-full:100%;--chakra-sizes-3xs:14rem;--chakra-sizes-2xs:16rem;--chakra-sizes-xs:20rem;--chakra-sizes-sm:24rem;--chakra-sizes-md:28rem;--chakra-sizes-lg:32rem;--chakra-sizes-xl:36rem;--chakra-sizes-2xl:42rem;--chakra-sizes-3xl:48rem;--chakra-sizes-4xl:56rem;--chakra-sizes-5xl:64rem;--chakra-sizes-6xl:72rem;--chakra-sizes-7xl:80rem;--chakra-sizes-8xl:90rem;--chakra-sizes-container-sm:640px;--chakra-sizes-container-md:768px;--chakra-sizes-container-lg:1024px;--chakra-sizes-container-xl:1280px;--chakra-zIndices-hide:-1;--chakra-zIndices-auto:auto;--chakra-zIndices-base:0;--chakra-zIndices-docked:10;--chakra-zIndices-dropdown:1000;--chakra-zIndices-sticky:1100;--chakra-zIndices-banner:1200;--chakra-zIndices-overlay:1300;--chakra-zIndices-modal:1400;--chakra-zIndices-popover:1500;--chakra-zIndices-skipLink:1600;--chakra-zIndices-toast:1700;--chakra-zIndices-tooltip:1800;--chakra-transition-property-common:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;--chakra-transition-property-colors:background-color,border-color,color,fill,stroke;--chakra-transition-property-dimensions:width,height;--chakra-transition-property-position:left,right,top,bottom;--chakra-transition-property-background:background-color,background-image,background-position;--chakra-transition-easing-ease-in:cubic-bezier(0.4, 0, 1, 1);--chakra-transition-easing-ease-out:cubic-bezier(0, 0, 0.2, 1);--chakra-transition-easing-ease-in-out:cubic-bezier(0.4, 0, 0.2, 1);--chakra-transition-duration-ultra-fast:50ms;--chakra-transition-duration-faster:100ms;--chakra-transition-duration-fast:150ms;--chakra-transition-duration-normal:200ms;--chakra-transition-duration-slow:300ms;--chakra-transition-duration-slower:400ms;--chakra-transition-duration-ultra-slow:500ms;--chakra-blur-none:0;--chakra-blur-sm:4px;--chakra-blur-base:8px;--chakra-blur-md:12px;--chakra-blur-lg:16px;--chakra-blur-xl:24px;--chakra-blur-2xl:40px;--chakra-blur-3xl:64px;}</style><style data-emotion="css-global 1syi0wy">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;font-feature-settings:'kern';}*,*::before,*::after{border-width:0;border-style:solid;box-sizing:border-box;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bold;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}body,blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]){outline:none;box-shadow:none;}select::-ms-expand{display:none;}</style><style data-emotion="css-global 1baqkrf">body{font-family:var(--chakra-fonts-body);color:var(--chakra-colors-gray-800);background:var(--chakra-colors-white);transition-property:background-color;transition-duration:var(--chakra-transition-duration-normal);line-height:var(--chakra-lineHeights-base);}*::-webkit-input-placeholder{color:var(--chakra-colors-gray-400);}*::-moz-placeholder{color:var(--chakra-colors-gray-400);}*:-ms-input-placeholder{color:var(--chakra-colors-gray-400);}*::placeholder{color:var(--chakra-colors-gray-400);}*,*::before,::after{border-color:var(--chakra-colors-gray-200);word-wrap:break-word;}</style><style data-emotion="css d4xd0d">.css-d4xd0d{background-color:var(--chakra-colors-green-50);min-height:100vh;}</style><div class="css-d4xd0d"><style data-emotion="css 50jqoj">.css-50jqoj{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-container-lg);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;background-color:var(--chakra-colors-green-600);}</style><div class="chakra-container css-50jqoj"><style data-emotion="css jbx4q3">.css-jbx4q3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;padding:var(--chakra-space-8);}</style><div class="css-jbx4q3"><style data-emotion="css 1dklj6k">.css-1dklj6k{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-3xl);line-height:1.33;}@media screen and (min-width: 48em){.css-1dklj6k{font-size:var(--chakra-fontSizes-4xl);line-height:1.2;}}</style><h2 class="chakra-heading css-1dklj6k"><style data-emotion="css 1naxmyz">.css-1naxmyz{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:var(--chakra-colors-white);}.css-1naxmyz:hover,.css-1naxmyz[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-1naxmyz:focus,.css-1naxmyz[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a class="chakra-link css-1naxmyz" href="/"><u class="chakra-text css-0">↗ agatan blog ↗</u></a></h2><style data-emotion="css 17xejub">.css-17xejub{-webkit-flex:1;-ms-flex:1;flex:1;justify-self:stretch;-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;}</style><div class="css-17xejub"></div><div class="css-0"><style data-emotion="css 1awjy5h">.css-1awjy5h{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:inherit;padding:var(--chakra-space-2);}.css-1awjy5h:hover,.css-1awjy5h[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-1awjy5h:focus,.css-1awjy5h[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a class="chakra-link css-1awjy5h" href="/feed.xml"><style data-emotion="css sjogs4">.css-sjogs4{width:var(--chakra-sizes-6);height:var(--chakra-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:var(--chakra-colors-white);}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" focusable="false" class="chakra-icon css-sjogs4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a><a class="chakra-link css-1awjy5h" href="/tags"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" focusable="false" class="chakra-icon css-sjogs4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg></a></div></div></div><style data-emotion="css 8shb6n">.css-8shb6n{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-container-lg);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;background-color:var(--chakra-colors-white);min-height:100vh;}</style><div class="chakra-container css-8shb6n"><style data-emotion="css 10qlibn">.css-10qlibn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-top:var(--chakra-space-4);padding-bottom:var(--chakra-space-4);}</style><div class="css-10qlibn"><style data-emotion="css 8jfdow">.css-8jfdow{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-container-lg);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;padding:0px;margin:0px;}</style><div class="chakra-container css-8jfdow"><style data-emotion="css nm5t63">.css-nm5t63{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-container-md);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;}</style><div class="chakra-container css-nm5t63"><style data-emotion="css 6euoq0">.css-6euoq0{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-3xl);line-height:1.33;padding-bottom:var(--chakra-space-4);}@media screen and (min-width: 48em){.css-6euoq0{line-height:1.2;}}</style><h2 class="chakra-heading css-6euoq0">ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」</h2><style data-emotion="css 8zn9ea">.css-8zn9ea{opacity:0.6;border:0;border-color:inherit;border-style:solid;border-bottom-width:1px;width:100%;padding:var(--chakra-space-2);}</style><hr aria-orientation="horizontal" class="chakra-divider css-8zn9ea"/><style data-emotion="css 1rwovhe">.css-1rwovhe{padding-top:var(--chakra-space-4);}</style><div class="css-1rwovhe"><div><style data-emotion="css ykzoaw">.css-ykzoaw{font-size:medium;line-height:var(--chakra-lineHeights-7);padding:var(--chakra-space-1);}</style><p class="chakra-text css-ykzoaw">ISUCON 7 お疲れ様でした！</p>
<p class="chakra-text css-ykzoaw">僕らのチーム，「<style data-emotion="css f4h6uy">.css-f4h6uy{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:inherit;}.css-f4h6uy:hover,.css-f4h6uy[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-f4h6uy:focus,.css-f4h6uy[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a class="chakra-link css-f4h6uy" href="http://d.hatena.ne.jp/keyword/%C5%D4%B1%C4%BB%B0%C5%C4%C0%FE"><style data-emotion="css hn1ydt">.css-hn1ydt{color:var(--chakra-colors-green-600);}</style><span class="chakra-text css-hn1ydt">都営三田線</span></a><a class="chakra-link css-f4h6uy" href="http://d.hatena.ne.jp/keyword/%C5%EC%B5%DE%CC%DC%B9%F5%C0%FE"><span class="chakra-text css-hn1ydt">東急目黒線</span></a>直通急行日吉行」は学生枠 2 位，全体で 10 位という結果でした．</p>
<p class="chakra-text css-ykzoaw">予選の結果が異常によかったので完全に調子に乗っていたんですが，本戦はやっぱり難しかったですね... 本戦でも社会人上位勢と戦えるくらいのスコアを出すのと学生枠優勝が目標だったのでやっぱりくやしい．</p>
<style data-emotion="css 1m5epeg">.css-1m5epeg{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:large;line-height:1.33;padding-top:var(--chakra-space-2);padding-bottom:var(--chakra-space-2);}@media screen and (min-width: 48em){.css-1m5epeg{line-height:1.2;}}</style><h2 class="chakra-heading css-1m5epeg" id="やったこと"><style data-emotion="css 70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-70qvj9"><a class="chakra-link css-1awjy5h" href="#やったこと"><style data-emotion="css ifa7ya">.css-ifa7ya{width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:var(--chakra-colors-gray-500);}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" focusable="false" class="chakra-icon css-ifa7ya" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>やったこと</div></h2>
<p class="chakra-text css-ykzoaw">結局テンパりすぎてスコア記録を残せていないので，なんとなく記憶を頼りに...</p>
<p class="chakra-text css-ykzoaw">Go 実装でいきました．</p>
<style data-emotion="css 1h3xlp0">.css-1h3xlp0{list-style-type:initial;-webkit-margin-start:1em;margin-inline-start:1em;padding-left:var(--chakra-space-4);}</style><ul role="list" class="css-1h3xlp0"><li class="css-0">room 名から ws をつなぎに行くホストが一台に固定されるように
<ul role="list" class="css-1h3xlp0"><li class="css-0">同じルームの action は全部同じホストにいくように</li><li class="css-0">これでオンメモリに出来るようにした（結局ほとんどオンメモリにデータは持たなかった）</li></ul>
</li><li class="css-0">ルーム名から適当な<a class="chakra-link css-f4h6uy" href="http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%B7%A5%E5%C3%CD"><span class="chakra-text css-hn1ydt">ハッシュ値</span></a>を計算してふるようにしていたけれど，ルームによってアクセス頻度とかがちがうっぽい？ことに気がつく
<ul role="list" class="css-1h3xlp0"><li class="css-0">3 台に振ってるはずなのに，CPU 使用率を見ると 2 台しか使われていないとか</li><li class="css-0">負荷分散が<a class="chakra-link css-f4h6uy" href="http://d.hatena.ne.jp/keyword/%B1%BF%A5%B2%A1%BC"><span class="chakra-text css-hn1ydt">運ゲー</span></a>になっていて改善の結果が見にくかったので，とりあえず 1 台しか使わないように</li></ul>
</li><li class="css-0">ホストごとの接続数を redis に入れて，空いていそうなところに振り分けるように
<ul role="list" class="css-1h3xlp0"><li class="css-0">前段のサーバに nginx + app + redis を入れて，そこの redis に room -&gt; host の対応情報を入れた</li><li class="css-0">CPU 使用率で振り分けたほうが良かったかもしれない</li></ul>
</li><li class="css-0">schedule の計算過程を最適化出来る気がしなかったので，結果をキャッシュしようと試みる
<ul role="list" class="css-1h3xlp0"><li class="css-0">どうやっても事後検証をパスできなかったので捨てることに...</li></ul>
</li><li class="css-0">部屋ごとにロックをとってすべての操作を直列にした
<ul role="list" class="css-1h3xlp0"><li class="css-0"><a class="chakra-link css-f4h6uy" href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%E9%A5%F3%A5%B6%A5%AF%A5%B7%A5%E7%A5%F3"><span class="chakra-text css-hn1ydt">トランザクション</span></a>とかが複雑すぎていじれる気がしなかったので，一旦直列にして考えることを減らそうとした</li><li class="css-0">rollback 考えなくて良くなったのでこれ自体は良かった気がする</li></ul>
</li><li class="css-0">@izumin5210 が adding/buying を redis にいれたり，過去の adding をまとめてくれた
<ul role="list" class="css-1h3xlp0"><li class="css-0">ここは完全におまかせしてしまった</li><li class="css-0">最終的にまともに効いたのはこれだけだったのでは</li></ul>
</li><li class="css-0">終盤はベンチマーカに弾かれる原因をひたすら探していた
<ul role="list" class="css-1h3xlp0"><li class="css-0">安全側に倒そうということで，色んな所でひたすらロックを取るようにしてなんとかパスした</li></ul>
</li></ul>
<p class="chakra-text css-ykzoaw">という感じで，最高スコアが 17000 くらい，最終スコアが 16700 で終了しました．</p>
<h2 class="chakra-heading css-1m5epeg" id="反省"><div class="css-70qvj9"><a class="chakra-link css-1awjy5h" href="#反省"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" focusable="false" class="chakra-icon css-ifa7ya" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>反省</div></h2>
<ul role="list" class="css-1h3xlp0"><li class="css-0">チーム名が長すぎた
<ul role="list" class="css-1h3xlp0"><li class="css-0">名札のチーム名部分のフォントが他のチームより小さかった気がする（ご迷惑おかけしていたらすみません...）</li><li class="css-0">手書きで書くのがつらすぎる</li><li class="css-0">来年は気をつけます</li></ul>
</li><li class="css-0">テストがせっかく用意されていたのにまったく使わなかった
<ul role="list" class="css-1h3xlp0"><li class="css-0">テスト使っていたらもうちょっと計算過程の最適化にも手を出せたかもしれない</li></ul>
</li><li class="css-0">なにも操作がなくても 500ms ごとに status を計算していたところの最適化を入れきることができなかった
<ul role="list" class="css-1h3xlp0"><li class="css-0">この計算は room ごとに一回やれば良いはずなのにコネクション一個につき一回計算していた</li><li class="css-0">room ごとにひたすら status を計算し続ける goroutine を起動してそこから返す実装を書いていたが，終盤の fail 祭りにびびっていれられなかった...</li><li class="css-0">意味があったかどうかはよくわからない．</li></ul>
</li><li class="css-0">CPU profile をみて，bigint の計算がやばいことはわかっていたのに，手が出せなかった
<ul role="list" class="css-1h3xlp0"><li class="css-0">この複雑さは結果をキャッシュしろってことだな！って勝手に思い込んでいたけど，結果のキャッシュも複雑で無理だった</li><li class="css-0">他のチームの方の話を聞く限り，そんなに無茶な最適化じゃなくても地道に最適化していたらそれなりにスコアに効いたのかもと思った（これはやってみないとわからないけど）</li></ul>
</li></ul>
<p class="chakra-text css-ykzoaw">予選のときも練習のときも，「遅いのはわかっているけど複雑そうでやりたくない」部分を触らないとだめっていう教訓は得ていたはずなんだけど，結局そこでやられてしまったのが一番くやしいですね...</p>
<p class="chakra-text css-ykzoaw">来年は学生枠ではなくなるのですが，社会人枠でも本戦にでて勝ちたいです！</p>
<p class="chakra-text css-ykzoaw">去年に引き続き本戦に出られたのはほんとうに良かったし，またまた勉強になる良い経験でした！運営の皆様お疲れ様でした ＆ ありがとうございました！</p>
<hr/>
<p class="chakra-text css-ykzoaw">COMMENT:
AUTHOR: davidcruise
IP: 117.98.190.10
DATE: 11/27/2017 21:25:12
<a class="chakra-link css-f4h6uy" href="https://www.kikforpcapp.com/kik-for-pc-windows-xp788-110-free-download/"><span class="chakra-text css-hn1ydt">pc kik</span></a> article on an innovative messaging amenity that is continually on, permanently linked with fast and unswerving than any added applications that are existing due to some of the following reasons.</p>
<hr/>
<hr/>
</div></div><hr aria-orientation="horizontal" class="chakra-divider css-8zn9ea"/><style data-emotion="css 1fgm4wo">.css-1fgm4wo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:var(--chakra-space-2);}</style><div class="css-1fgm4wo"><div class="css-17xejub"></div><style data-emotion="css rjrdo">.css-rjrdo{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:var(--chakra-colors-green-500);}.css-rjrdo:hover,.css-rjrdo[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-rjrdo:focus,.css-rjrdo[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a class="chakra-link css-rjrdo" href="https://github.com/agatan/agatan.github.io/blob/main/posts/ISUCON_7_本戦出場してきました_「都営三田線東急目黒線直通急行日吉行」.md"><style data-emotion="css 6ey7w3">.css-6ey7w3{width:var(--chakra-sizes-6);height:var(--chakra-sizes-6);display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" focusable="false" class="chakra-icon css-6ey7w3" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><style data-emotion="css 1syq16t">.css-1syq16t{padding:var(--chakra-space-2);}</style><span class="chakra-text css-1syq16t">GitHub で編集リクエスト</span></a></div></div></div><style data-emotion="css ul4ode">.css-ul4ode{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-44);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;}</style><div class="chakra-container css-ul4ode"><style data-emotion="css xkvmla">.css-xkvmla{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:var(--chakra-space-4);}</style><div class="css-xkvmla"><a class="chakra-link css-f4h6uy" href="https://twitter.com/@agatan_"><style data-emotion="css 1piy145">.css-1piy145{position:relative;width:var(--chakra-sizes-20);height:var(--chakra-sizes-20);}</style><div class="css-1piy145"><style data-emotion="css 1phd9a0">.css-1phd9a0{object-fit:cover;}</style><img alt="agatan" class="chakra-image__placeholder css-1phd9a0" layout="fill"/></div><style data-emotion="css 19dx7hn">.css-19dx7hn{text-align:center;font-size:large;}</style><p class="chakra-text css-19dx7hn">@agatan</p></a><style data-emotion="css 84zodg">.css-84zodg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-84zodg>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0.5rem;margin-inline-start:0.5rem;}</style><div class="chakra-stack css-84zodg"><style data-emotion="css 1h1f62l">.css-1h1f62l{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:inherit;padding:var(--chakra-space-1);}.css-1h1f62l:hover,.css-1h1f62l[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-1h1f62l:focus,.css-1h1f62l[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a class="chakra-link css-1h1f62l" href="https://twitter.com/@agatan_"><style data-emotion="css 15e9ude">.css-15e9ude{width:1.2em;height:1.2em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" focusable="true" class="chakra-icon css-15e9ude" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a class="chakra-link css-1h1f62l" href="https://github.com/agatan"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" focusable="true" class="chakra-icon css-15e9ude" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></div></div></div></div></div><span></span></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\u003cp\u003eISUCON 7 お疲れ様でした！\u003c/p\u003e\n\u003cp\u003e僕らのチーム，「\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%D4%B1%C4%BB%B0%C5%C4%C0%FE\"\u003e都営三田線\u003c/a\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%EC%B5%DE%CC%DC%B9%F5%C0%FE\"\u003e東急目黒線\u003c/a\u003e直通急行日吉行」は学生枠 2 位，全体で 10 位という結果でした．\u003c/p\u003e\n\u003cp\u003e予選の結果が異常によかったので完全に調子に乗っていたんですが，本戦はやっぱり難しかったですね... 本戦でも社会人上位勢と戦えるくらいのスコアを出すのと学生枠優勝が目標だったのでやっぱりくやしい．\u003c/p\u003e\n\u003ch3\u003eやったこと\u003c/h3\u003e\n\u003cp\u003e結局テンパりすぎてスコア記録を残せていないので，なんとなく記憶を頼りに...\u003c/p\u003e\n\u003cp\u003eGo 実装でいきました．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eroom 名から ws をつなぎに行くホストが一台に固定されるように\n\u003cul\u003e\n\u003cli\u003e同じルームの action は全部同じホストにいくように\u003c/li\u003e\n\u003cli\u003eこれでオンメモリに出来るようにした（結局ほとんどオンメモリにデータは持たなかった）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eルーム名から適当な\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%B7%A5%E5%C3%CD\"\u003eハッシュ値\u003c/a\u003eを計算してふるようにしていたけれど，ルームによってアクセス頻度とかがちがうっぽい？ことに気がつく\n\u003cul\u003e\n\u003cli\u003e3 台に振ってるはずなのに，CPU 使用率を見ると 2 台しか使われていないとか\u003c/li\u003e\n\u003cli\u003e負荷分散が\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B1%BF%A5%B2%A1%BC\"\u003e運ゲー\u003c/a\u003eになっていて改善の結果が見にくかったので，とりあえず 1 台しか使わないように\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eホストごとの接続数を redis に入れて，空いていそうなところに振り分けるように\n\u003cul\u003e\n\u003cli\u003e前段のサーバに nginx + app + redis を入れて，そこの redis に room -\u003e host の対応情報を入れた\u003c/li\u003e\n\u003cli\u003eCPU 使用率で振り分けたほうが良かったかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eschedule の計算過程を最適化出来る気がしなかったので，結果をキャッシュしようと試みる\n\u003cul\u003e\n\u003cli\u003eどうやっても事後検証をパスできなかったので捨てることに...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e部屋ごとにロックをとってすべての操作を直列にした\n\u003cul\u003e\n\u003cli\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A5%E9%A5%F3%A5%B6%A5%AF%A5%B7%A5%E7%A5%F3\"\u003eトランザクション\u003c/a\u003eとかが複雑すぎていじれる気がしなかったので，一旦直列にして考えることを減らそうとした\u003c/li\u003e\n\u003cli\u003erollback 考えなくて良くなったのでこれ自体は良かった気がする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e@izumin5210 が adding/buying を redis にいれたり，過去の adding をまとめてくれた\n\u003cul\u003e\n\u003cli\u003eここは完全におまかせしてしまった\u003c/li\u003e\n\u003cli\u003e最終的にまともに効いたのはこれだけだったのでは\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e終盤はベンチマーカに弾かれる原因をひたすら探していた\n\u003cul\u003e\n\u003cli\u003e安全側に倒そうということで，色んな所でひたすらロックを取るようにしてなんとかパスした\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eという感じで，最高スコアが 17000 くらい，最終スコアが 16700 で終了しました．\u003c/p\u003e\n\u003ch3\u003e反省\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eチーム名が長すぎた\n\u003cul\u003e\n\u003cli\u003e名札のチーム名部分のフォントが他のチームより小さかった気がする（ご迷惑おかけしていたらすみません...）\u003c/li\u003e\n\u003cli\u003e手書きで書くのがつらすぎる\u003c/li\u003e\n\u003cli\u003e来年は気をつけます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eテストがせっかく用意されていたのにまったく使わなかった\n\u003cul\u003e\n\u003cli\u003eテスト使っていたらもうちょっと計算過程の最適化にも手を出せたかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eなにも操作がなくても 500ms ごとに status を計算していたところの最適化を入れきることができなかった\n\u003cul\u003e\n\u003cli\u003eこの計算は room ごとに一回やれば良いはずなのにコネクション一個につき一回計算していた\u003c/li\u003e\n\u003cli\u003eroom ごとにひたすら status を計算し続ける goroutine を起動してそこから返す実装を書いていたが，終盤の fail 祭りにびびっていれられなかった...\u003c/li\u003e\n\u003cli\u003e意味があったかどうかはよくわからない．\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCPU profile をみて，bigint の計算がやばいことはわかっていたのに，手が出せなかった\n\u003cul\u003e\n\u003cli\u003eこの複雑さは結果をキャッシュしろってことだな！って勝手に思い込んでいたけど，結果のキャッシュも複雑で無理だった\u003c/li\u003e\n\u003cli\u003e他のチームの方の話を聞く限り，そんなに無茶な最適化じゃなくても地道に最適化していたらそれなりにスコアに効いたのかもと思った（これはやってみないとわからないけど）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e予選のときも練習のときも，「遅いのはわかっているけど複雑そうでやりたくない」部分を触らないとだめっていう教訓は得ていたはずなんだけど，結局そこでやられてしまったのが一番くやしいですね...\u003c/p\u003e\n\u003cp\u003e来年は学生枠ではなくなるのですが，社会人枠でも本戦にでて勝ちたいです！\u003c/p\u003e\n\u003cp\u003e去年に引き続き本戦に出られたのはほんとうに良かったし，またまた勉強になる良い経験でした！運営の皆様お疲れ様でした ＆ ありがとうございました！\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eCOMMENT:\nAUTHOR: davidcruise\nIP: 117.98.190.10\nDATE: 11/27/2017 21:25:12\n\u003ca href='https://www.kikforpcapp.com/kik-for-pc-windows-xp788-110-free-download/'\u003epc kik\u003c/a\u003e article on an innovative messaging amenity that is continually on, permanently linked with fast and unswerving than any added applications that are existing due to some of the following reasons.\u003c/p\u003e\n\u003chr\u003e\n\u003chr\u003e\n","meta":{"rawMarkdown":"---\ntitle: \"ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」\"\ndate: 2017-11-26T05:18:59.000Z\ntags: []\n---\n\n\u003cp\u003eISUCON 7 お疲れ様でした！\u003c/p\u003e\n\n\u003cp\u003e僕らのチーム，「\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%D4%B1%C4%BB%B0%C5%C4%C0%FE\"\u003e都営三田線\u003c/a\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%EC%B5%DE%CC%DC%B9%F5%C0%FE\"\u003e東急目黒線\u003c/a\u003e直通急行日吉行」は学生枠 2 位，全体で 10 位という結果でした．\u003c/p\u003e\n\n\u003cp\u003e予選の結果が異常によかったので完全に調子に乗っていたんですが，本戦はやっぱり難しかったですね... 本戦でも社会人上位勢と戦えるくらいのスコアを出すのと学生枠優勝が目標だったのでやっぱりくやしい．\u003c/p\u003e\n\n\u003ch3\u003eやったこと\u003c/h3\u003e\n\n\u003cp\u003e結局テンパりすぎてスコア記録を残せていないので，なんとなく記憶を頼りに...\u003c/p\u003e\n\n\u003cp\u003eGo 実装でいきました．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eroom 名から ws をつなぎに行くホストが一台に固定されるように\n\n\u003cul\u003e\n\u003cli\u003e同じルームの action は全部同じホストにいくように\u003c/li\u003e\n\u003cli\u003eこれでオンメモリに出来るようにした（結局ほとんどオンメモリにデータは持たなかった）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eルーム名から適当な\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%B7%A5%E5%C3%CD\"\u003eハッシュ値\u003c/a\u003eを計算してふるようにしていたけれど，ルームによってアクセス頻度とかがちがうっぽい？ことに気がつく\n\n\u003cul\u003e\n\u003cli\u003e3 台に振ってるはずなのに，CPU 使用率を見ると 2 台しか使われていないとか\u003c/li\u003e\n\u003cli\u003e負荷分散が\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B1%BF%A5%B2%A1%BC\"\u003e運ゲー\u003c/a\u003eになっていて改善の結果が見にくかったので，とりあえず 1 台しか使わないように\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eホストごとの接続数を redis に入れて，空いていそうなところに振り分けるように\n\n\u003cul\u003e\n\u003cli\u003e前段のサーバに nginx + app + redis を入れて，そこの redis に room -\u003e host の対応情報を入れた\u003c/li\u003e\n\u003cli\u003eCPU 使用率で振り分けたほうが良かったかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eschedule の計算過程を最適化出来る気がしなかったので，結果をキャッシュしようと試みる\n\n\u003cul\u003e\n\u003cli\u003eどうやっても事後検証をパスできなかったので捨てることに...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e部屋ごとにロックをとってすべての操作を直列にした\n\n\u003cul\u003e\n\u003cli\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A5%E9%A5%F3%A5%B6%A5%AF%A5%B7%A5%E7%A5%F3\"\u003eトランザクション\u003c/a\u003eとかが複雑すぎていじれる気がしなかったので，一旦直列にして考えることを減らそうとした\u003c/li\u003e\n\u003cli\u003erollback 考えなくて良くなったのでこれ自体は良かった気がする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e@izumin5210 が adding/buying を redis にいれたり，過去の adding をまとめてくれた\n\n\u003cul\u003e\n\u003cli\u003eここは完全におまかせしてしまった\u003c/li\u003e\n\u003cli\u003e最終的にまともに効いたのはこれだけだったのでは\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e終盤はベンチマーカに弾かれる原因をひたすら探していた\n\n\u003cul\u003e\n\u003cli\u003e安全側に倒そうということで，色んな所でひたすらロックを取るようにしてなんとかパスした\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという感じで，最高スコアが 17000 くらい，最終スコアが 16700 で終了しました．\u003c/p\u003e\n\n\u003ch3\u003e反省\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eチーム名が長すぎた\n\n\u003cul\u003e\n\u003cli\u003e名札のチーム名部分のフォントが他のチームより小さかった気がする（ご迷惑おかけしていたらすみません...）\u003c/li\u003e\n\u003cli\u003e手書きで書くのがつらすぎる\u003c/li\u003e\n\u003cli\u003e来年は気をつけます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eテストがせっかく用意されていたのにまったく使わなかった\n\n\u003cul\u003e\n\u003cli\u003eテスト使っていたらもうちょっと計算過程の最適化にも手を出せたかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eなにも操作がなくても 500ms ごとに status を計算していたところの最適化を入れきることができなかった\n\n\u003cul\u003e\n\u003cli\u003eこの計算は room ごとに一回やれば良いはずなのにコネクション一個につき一回計算していた\u003c/li\u003e\n\u003cli\u003eroom ごとにひたすら status を計算し続ける goroutine を起動してそこから返す実装を書いていたが，終盤の fail 祭りにびびっていれられなかった...\u003c/li\u003e\n\u003cli\u003e意味があったかどうかはよくわからない．\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCPU profile をみて，bigint の計算がやばいことはわかっていたのに，手が出せなかった\n\n\u003cul\u003e\n\u003cli\u003eこの複雑さは結果をキャッシュしろってことだな！って勝手に思い込んでいたけど，結果のキャッシュも複雑で無理だった\u003c/li\u003e\n\u003cli\u003e他のチームの方の話を聞く限り，そんなに無茶な最適化じゃなくても地道に最適化していたらそれなりにスコアに効いたのかもと思った（これはやってみないとわからないけど）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e予選のときも練習のときも，「遅いのはわかっているけど複雑そうでやりたくない」部分を触らないとだめっていう教訓は得ていたはずなんだけど，結局そこでやられてしまったのが一番くやしいですね...\u003c/p\u003e\n\n\u003cp\u003e来年は学生枠ではなくなるのですが，社会人枠でも本戦にでて勝ちたいです！\u003c/p\u003e\n\n\u003cp\u003e去年に引き続き本戦に出られたのはほんとうに良かったし，またまた勉強になる良い経験でした！運営の皆様お疲れ様でした ＆ ありがとうございました！\u003c/p\u003e\n\n---\n\nCOMMENT:\nAUTHOR: davidcruise\nIP: 117.98.190.10\nDATE: 11/27/2017 21:25:12\n\u003ca href='https://www.kikforpcapp.com/kik-for-pc-windows-xp788-110-free-download/'\u003epc kik\u003c/a\u003e article on an innovative messaging amenity that is continually on, permanently linked with fast and unswerving than any added applications that are existing due to some of the following reasons.\n\n---\n\n---\n","contentMarkdown":"\n\u003cp\u003eISUCON 7 お疲れ様でした！\u003c/p\u003e\n\n\u003cp\u003e僕らのチーム，「\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%D4%B1%C4%BB%B0%C5%C4%C0%FE\"\u003e都営三田線\u003c/a\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%EC%B5%DE%CC%DC%B9%F5%C0%FE\"\u003e東急目黒線\u003c/a\u003e直通急行日吉行」は学生枠 2 位，全体で 10 位という結果でした．\u003c/p\u003e\n\n\u003cp\u003e予選の結果が異常によかったので完全に調子に乗っていたんですが，本戦はやっぱり難しかったですね... 本戦でも社会人上位勢と戦えるくらいのスコアを出すのと学生枠優勝が目標だったのでやっぱりくやしい．\u003c/p\u003e\n\n\u003ch3\u003eやったこと\u003c/h3\u003e\n\n\u003cp\u003e結局テンパりすぎてスコア記録を残せていないので，なんとなく記憶を頼りに...\u003c/p\u003e\n\n\u003cp\u003eGo 実装でいきました．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eroom 名から ws をつなぎに行くホストが一台に固定されるように\n\n\u003cul\u003e\n\u003cli\u003e同じルームの action は全部同じホストにいくように\u003c/li\u003e\n\u003cli\u003eこれでオンメモリに出来るようにした（結局ほとんどオンメモリにデータは持たなかった）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eルーム名から適当な\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%B7%A5%E5%C3%CD\"\u003eハッシュ値\u003c/a\u003eを計算してふるようにしていたけれど，ルームによってアクセス頻度とかがちがうっぽい？ことに気がつく\n\n\u003cul\u003e\n\u003cli\u003e3 台に振ってるはずなのに，CPU 使用率を見ると 2 台しか使われていないとか\u003c/li\u003e\n\u003cli\u003e負荷分散が\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B1%BF%A5%B2%A1%BC\"\u003e運ゲー\u003c/a\u003eになっていて改善の結果が見にくかったので，とりあえず 1 台しか使わないように\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eホストごとの接続数を redis に入れて，空いていそうなところに振り分けるように\n\n\u003cul\u003e\n\u003cli\u003e前段のサーバに nginx + app + redis を入れて，そこの redis に room -\u003e host の対応情報を入れた\u003c/li\u003e\n\u003cli\u003eCPU 使用率で振り分けたほうが良かったかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eschedule の計算過程を最適化出来る気がしなかったので，結果をキャッシュしようと試みる\n\n\u003cul\u003e\n\u003cli\u003eどうやっても事後検証をパスできなかったので捨てることに...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e部屋ごとにロックをとってすべての操作を直列にした\n\n\u003cul\u003e\n\u003cli\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A5%E9%A5%F3%A5%B6%A5%AF%A5%B7%A5%E7%A5%F3\"\u003eトランザクション\u003c/a\u003eとかが複雑すぎていじれる気がしなかったので，一旦直列にして考えることを減らそうとした\u003c/li\u003e\n\u003cli\u003erollback 考えなくて良くなったのでこれ自体は良かった気がする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e@izumin5210 が adding/buying を redis にいれたり，過去の adding をまとめてくれた\n\n\u003cul\u003e\n\u003cli\u003eここは完全におまかせしてしまった\u003c/li\u003e\n\u003cli\u003e最終的にまともに効いたのはこれだけだったのでは\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e終盤はベンチマーカに弾かれる原因をひたすら探していた\n\n\u003cul\u003e\n\u003cli\u003e安全側に倒そうということで，色んな所でひたすらロックを取るようにしてなんとかパスした\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという感じで，最高スコアが 17000 くらい，最終スコアが 16700 で終了しました．\u003c/p\u003e\n\n\u003ch3\u003e反省\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eチーム名が長すぎた\n\n\u003cul\u003e\n\u003cli\u003e名札のチーム名部分のフォントが他のチームより小さかった気がする（ご迷惑おかけしていたらすみません...）\u003c/li\u003e\n\u003cli\u003e手書きで書くのがつらすぎる\u003c/li\u003e\n\u003cli\u003e来年は気をつけます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eテストがせっかく用意されていたのにまったく使わなかった\n\n\u003cul\u003e\n\u003cli\u003eテスト使っていたらもうちょっと計算過程の最適化にも手を出せたかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eなにも操作がなくても 500ms ごとに status を計算していたところの最適化を入れきることができなかった\n\n\u003cul\u003e\n\u003cli\u003eこの計算は room ごとに一回やれば良いはずなのにコネクション一個につき一回計算していた\u003c/li\u003e\n\u003cli\u003eroom ごとにひたすら status を計算し続ける goroutine を起動してそこから返す実装を書いていたが，終盤の fail 祭りにびびっていれられなかった...\u003c/li\u003e\n\u003cli\u003e意味があったかどうかはよくわからない．\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCPU profile をみて，bigint の計算がやばいことはわかっていたのに，手が出せなかった\n\n\u003cul\u003e\n\u003cli\u003eこの複雑さは結果をキャッシュしろってことだな！って勝手に思い込んでいたけど，結果のキャッシュも複雑で無理だった\u003c/li\u003e\n\u003cli\u003e他のチームの方の話を聞く限り，そんなに無茶な最適化じゃなくても地道に最適化していたらそれなりにスコアに効いたのかもと思った（これはやってみないとわからないけど）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e予選のときも練習のときも，「遅いのはわかっているけど複雑そうでやりたくない」部分を触らないとだめっていう教訓は得ていたはずなんだけど，結局そこでやられてしまったのが一番くやしいですね...\u003c/p\u003e\n\n\u003cp\u003e来年は学生枠ではなくなるのですが，社会人枠でも本戦にでて勝ちたいです！\u003c/p\u003e\n\n\u003cp\u003e去年に引き続き本戦に出られたのはほんとうに良かったし，またまた勉強になる良い経験でした！運営の皆様お疲れ様でした ＆ ありがとうございました！\u003c/p\u003e\n\n---\n\nCOMMENT:\nAUTHOR: davidcruise\nIP: 117.98.190.10\nDATE: 11/27/2017 21:25:12\n\u003ca href='https://www.kikforpcapp.com/kik-for-pc-windows-xp788-110-free-download/'\u003epc kik\u003c/a\u003e article on an innovative messaging amenity that is continually on, permanently linked with fast and unswerving than any added applications that are existing due to some of the following reasons.\n\n---\n\n---\n","slug":"ISUCON_7_本戦出場してきました_「都営三田線東急目黒線直通急行日吉行」","title":"ISUCON 7 本戦出場してきました 「都営三田線東急目黒線直通急行日吉行」","timestamp":1511673539000,"tags":[]}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"ISUCON_7_本戦出場してきました_「都営三田線東急目黒線直通急行日吉行」"},"buildId":"LTCqLRPEd5Qd2agqEQJZo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>