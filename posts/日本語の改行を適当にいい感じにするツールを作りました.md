---
title: "日本語の改行を適当にいい感じにするツールを作りました"
date: 2016-10-29T04:24:49.000Z
tags: []
---
<p>必要に迫られて、HTML ページ内の改行位置をいい感じにするツールを作ってみました。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fagatan%2Fjapawrap" title="agatan/japawrap" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://github.com/agatan/japawrap">github.com</a></cite></p>

<p>HTMLに長文を書くと、親 DOM のサイズの制約上、適宜改行がぶちこまれます。
しかし、改行位置は文節を考慮などせずにごりっと挿入されるので、多くの問題が生じることが報告されています。
最も有名な問題として、今すぐダウンロー<br>
ド問題が挙げられます。</p>

<p><code>japawrap</code> を使うと、それっぽく日本語を解釈して <code>&lt;span&gt;</code> でくくるみたいなことができます。<code>inline-block</code> を適用すれば改行がそれっぽく入るようにできます。</p>

<h2>Install</h2>

<p><code>go get github.com/agatan/japawrap/...</code></p>

<p>で <code>japawrap</code> コマンドが使えるようになります。</p>

<h2>Usage</h2>

<h3><a class="keyword" href="http://d.hatena.ne.jp/keyword/CLI">CLI</a></h3>

<p>ファイル名を指定するか標準入力から流し込みます。</p>

<pre class="code" data-lang="" data-unlink>$ echo &#34;今日も元気です&#34; | japawrap
&lt;span class=&#34;wordwrap&#34;&gt;今日も&lt;/span&gt;&lt;span class=&#34;wordwrap&#34;&gt;元気です&lt;/span&gt;</pre>


<p>このように適宜いい感じに wrap してくれます。</p>

<p>オプションとして <code>-open string</code> と <code>-close string</code> をサポートしているので、</p>

<pre class="code" data-lang="" data-unlink>$ echo &#34;今日も元気です&#34; | japawrap -open &#39;&lt;span style=&#34;display: inline-block;&#34;&gt;&#39; -close &#34;&lt;/span&gt;&#34; 
&lt;span style=&#34;display: inline-block;&#34;&gt;今日も&lt;/span&gt;&lt;span style=&#34;display: inline-block;&#34;&gt;元気です&lt;/span&gt;</pre>


<p>みたいなことができます。</p>

<h3>Library</h3>

<p>一応 <code>japawrap</code> はライブラリとしても使用できるようになっています。</p>

<pre class="code lang-go" data-lang="go" data-unlink>w := japawrap.New(open, <span class="synStatement">close</span>)
s := <span class="synConstant">&quot;今日も元気です&quot;</span>
fmt.Println(<span class="synConstant">&quot;%s =&gt; %s&quot;</span>, s, w.Do(s))
</pre>


<p>これだけです。</p>

<h2>Example</h2>

<p>では実際に使った結果を下に記したいと思います。
文章は、上の方に自分で書いた文章をそのまま使います。</p>

<hr />

<h4>before</h4>

<p>HTMLに長文を書くと、親DOM のサイズの制約上、適宜改行がぶちこまれます。
しかし、改行位置は文節を考慮などせずにごりっと挿入されるので、多くの問題が生じることが報告されています。
最も有名な問題として、今すぐダウンロード問題が挙げられます。</p>

<h4>after</h4>

<p><span style="display: inline-block;">HTMLに</span><span style="display: inline-block;">長文を</span><span style="display: inline-block;">書くと、</span><span style="display: inline-block;">親 </span><span style="display: inline-block;">DOM の</span><span style="display: inline-block;">サイズの</span><span style="display: inline-block;">制約上、</span><span style="display: inline-block;">適宜改行が</span><span style="display: inline-block;">ぶちこまれます。</span>
<span style="display: inline-block;">しかし、</span><span style="display: inline-block;">改行位置は</span><span style="display: inline-block;">文節を</span><span style="display: inline-block;">考慮など</span><span style="display: inline-block;">せず</span><span style="display: inline-block;">にごりっと</span><span style="display: inline-block;">挿入されるので、</span><span style="display: inline-block;">多くの</span><span style="display: inline-block;">問題が</span><span style="display: inline-block;">生じる</span><span style="display: inline-block;">ことが</span><span style="display: inline-block;">報告されて</span><span style="display: inline-block;">います。</span>
<span style="display: inline-block;">最も</span><span style="display: inline-block;">有名な</span><span style="display: inline-block;">問題として、<span style="display: inline-block;">今すぐ</span><span style="display: inline-block;">ダウンロード問題が</span><span style="display: inline-block;">挙げられます。</span></p>

<hr />

<p>こんな感じになります。猛烈に効果がわかりにくくて驚いていますが、一応効果はちゃんと出ているのではないでしょうか？
HTMLを直接見ていただければどうなっているかはわかると思います。</p>

<p>次に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C0%C4%B6%F5%CA%B8%B8%CB">青空文庫</a>から<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%C6%CC%DC%DE%FB%C0%D0">夏目漱石</a>「こころ」の序文を抜粋してみたのが下の画像たちです。</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/a/agtn/20161029/20161029131814.png" alt="f:id:agtn:20161029131814p:plain" title="f:id:agtn:20161029131814p:plain" class="hatena-fotolife" itemprop="image"></span><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/a/agtn/20161029/20161029131817.png" alt="f:id:agtn:20161029131817p:plain" title="f:id:agtn:20161029131817p:plain" class="hatena-fotolife" itemprop="image"></span><span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/a/agtn/20161029/20161029131820.png" alt="f:id:agtn:20161029131820p:plain" title="f:id:agtn:20161029131820p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>レスポンシブ！それなりになっている気がします。</p>

<h4>あとがき</h4>

<p>この問題へのアプローチとして、<a href="https://github.com/google/budou">https://github.com/google/budou</a> が有名だと思います。</p>

<p><code>budou</code> は　<a href="https://cloud.google.com/natural-language/">Cloud Natural Language API</a> を内部で使っていて、しっかり日本語の文章を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B9%BD%CA%B8%B2%F2%C0%CF">構文解析</a>しているようです。
なので非常に精度は高いと思うのですが、今僕の <a class="keyword" href="http://d.hatena.ne.jp/keyword/GCP">GCP</a> アカウントがごにょごにょしていてぱぱっと試せる状況ではなかったので自作しました。</p>

<p><code>budou</code> と違ってしっかり<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B9%BD%CA%B8%B2%F2%C0%CF">構文解析</a>などはしていなくて、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B7%C1%C2%D6%C1%C7%B2%F2%C0%CF">形態素解析</a>した後、それっぽく分割しているだけです。なので精度は落ちると思います。
一方、<code>budou</code> は <a class="keyword" href="http://d.hatena.ne.jp/keyword/GCP">GCP</a> の credentails が必要だったりと準備が必要になるので、お手軽に試せるというのは悪くないかなと思っています。</p>

-----
--------